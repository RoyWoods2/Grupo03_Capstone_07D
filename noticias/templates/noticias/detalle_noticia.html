{% extends "polls/detail.html" %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'noticias/css/styleNoticia.css' %}">

<div class="detalle-noticia-container">
    <h1>{{ noticia.titulo }}</h1>
    <p class="noticia-meta">Redactado por {{ noticia.autor }} el {{ noticia.fecha|date:"d M Y H:" }}</p>
    
    {% if noticia.imagen_encabezado %}
        <img src="{{ noticia.imagen_encabezado.url }}" alt="{{ noticia.titulo }}" class="noticia-imagen">
    {% endif %}
    
    <div class="noticia-contenido">
        <p>{{ noticia.contenido }}</p>
    </div>
</div>

    <!-- Formulario para agregar un nuevo comentario -->
    {% if user.is_authenticated %}
        <h4>Agregar un comentario</h4>
        <form method="POST">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-primary">Comentar</button>
        </form>
    {% else %}
        <p><a href="{% url 'polls:login' %}">Inicia sesi√≥n</a> para comentar.</p>
    {% endif %}
</div>

<div class="comentarios">
    {% for comentario in comentarios %}
        <div class="comentario">
            <img src="{{ comentario.usuario.userprofile.avatar.url }}" alt="Avatar de {{ comentario.usuario.username }}" class="avatar">
            <strong>{{ comentario.usuario.userprofile.nick }}</strong> - {{ comentario.fecha_creacion }}
            <p>{{ comentario.contenido }}</p>
            
            <!-- Formulario para Responder -->
            <form method="post">
                {% csrf_token %}
                {{ form.as_p }}
                <input type="hidden" name="respuesta_id" value="{{ comentario.id }}">
                <button type="submit">Responder</button>
            </form>

            <!-- Mostrar Respuestas -->
            {% for respuesta in comentario.respuestas.all %}
                <div class="respuesta">
                    <img src="{{ respuesta.usuario.userprofile.avatar.url }}" alt="Avatar de {{ respuesta.usuario.username }}" class="avatar">
                    <strong>{{ respuesta.usuario.userprofile.nick }}</strong> - {{ respuesta.fecha_creacion }}
                    <p>{{ respuesta.contenido }}</p>
                </div>
            {% endfor %}
        </div>
    {% endfor %}
</div>
{% endblock %}